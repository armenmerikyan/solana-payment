<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Payment</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/buffer/6.0.3/index.min.js"></script>
    <script>
        window.Buffer = window.Buffer || buffer.Buffer;
    </script>
    
</head>
<body>
    <button onclick="connectWallet()">Connect Wallet</button>
    <button onclick="sendSol()">Send 0.01 SOL</button>

    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        const { Connection, PublicKey, Transaction, SystemProgram } = solanaWeb3;
        let userPublicKey = null;

        // ðŸŸ¢ 1. Connect to Phantom Wallet
        const connectWallet = async () => {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const response = await window.solana.connect();
                    userPublicKey = response.publicKey;
                    console.log("Connected with Public Key:", userPublicKey.toString());
                    alert("Wallet Connected!");
                } catch (err) {
                    console.error("Wallet connection failed:", err);
                }
            } else {
                alert("Phantom Wallet not found. Please install it.");
            }
        };

        // ðŸŸ¢ 2. Send SOL Transaction
        const sendSol = async () => {
            if (!userPublicKey) {
                alert("Connect your Phantom Wallet first!");
                return;
            }

            try {
                const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");
                const recipientAddress = "3VSPtEBgfrCHS7UoessBx1FF275Gkw3CeQswR9pCZznS"; // Replace with the actual recipient address
                const toPublicKey = new PublicKey(recipientAddress);

                const transaction = new Transaction().add(
                    SystemProgram.transfer({
                        fromPubkey: userPublicKey,
                        toPubkey: toPublicKey,
                        lamports: 0.01 * 1e9, // Convert SOL to lamports
                    })
                );

                transaction.feePayer = userPublicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

                // ðŸ”¹ Open Phantom Wallet for user to sign
                const signedTransaction = await window.solana.signTransaction(transaction);

                // ðŸ”¹ Send the signed transaction to Solana blockchain
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());

                console.log("Transaction Signature:", signature);
                alert(`Transaction Sent! Check Explorer:\nhttps://explorer.solana.com/tx/${signature}`);
            } catch (err) {
                console.error("Transaction failed:", err);
                alert("Transaction failed! Check console.");
            }
        };
    </script>
</body>
</html>
