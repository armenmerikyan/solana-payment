<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Payment</title>
</head>
<body>
    <h1>Send Solana with Phantom Wallet</h1>
    <button onclick="connectWallet()">Connect Wallet</button>
    <button onclick="sendSol()">Send 0.01 SOL</button>

    <p id="walletAddress"></p>

    <!-- Solana Web3.js -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <script>
        let userPublicKey = null;

        // ðŸŸ¢ 1. Connect to Phantom Wallet
        const connectWallet = async () => {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const response = await window.solana.connect();
                    userPublicKey = response.publicKey;
                    document.getElementById("walletAddress").innerText = `Connected Wallet: ${userPublicKey.toString()}`;
                    alert("Wallet Connected!");
                } catch (err) {
                    console.error("Wallet connection failed:", err);
                    alert("Wallet connection failed!");
                }
            } else {
                alert("Phantom Wallet not found. Please install it.");
            }
        };

        // ðŸŸ¢ 2. Send SOL Transaction
        const sendSol = async () => {
            if (!userPublicKey) {
                alert("Connect your Phantom Wallet first!");
                return;
            }

            try {
                const rpcUrl = 'https://solana-mainnet.g.alchemy.com/v2/brUu7bUWYqnL02KEqM_k1GWoLgTtkGvg'; // Replace with your QuickNode URL
                console.log('RPC URL:', rpcUrl);
                const connection = new solanaWeb3.Connection(rpcUrl);

                //const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"), "confirmed");
                const recipientAddress = "3VSPtEBgfrCHS7UoessBx1FF275Gkw3CeQswR9pCZznS"; // Replace with actual recipient address
                const toPublicKey = new solanaWeb3.PublicKey(recipientAddress);

                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: userPublicKey,
                        toPubkey: toPublicKey,
                        lamports: 0.01 * 1e9, // Convert SOL to lamports
                    })
                );

                transaction.feePayer = userPublicKey;
                transaction.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;

                // ðŸ”¹ Open Phantom Wallet for user to sign
                const signedTransaction = await window.solana.signTransaction(transaction);

                // ðŸ”¹ Send the signed transaction to Solana blockchain
                const signature = await connection.sendRawTransaction(signedTransaction.serialize());

                console.log("Transaction Signature:", signature);
                alert(`Transaction Sent! Check Explorer:\nhttps://solscan.com/tx/${signature}`);
            } catch (err) {
                console.error("Transaction failed:", err);
                alert("Transaction failed! Check console.");
            }
        };
    </script>
</body>
</html>